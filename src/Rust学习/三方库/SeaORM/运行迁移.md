# è¿è¡Œè¿ç§»

## 1. å‘½ä»¤è¡Œæ“ä½œ (CLI)

åœ¨ç»ˆç«¯é‡Œï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ§åˆ¶æ•°æ®åº“çš„è¿›åŒ–ã€‚

> **æ³¨æ„** ï¼šè¿è¡Œè¿™äº›å‘½ä»¤å‰ï¼Œå¿…é¡»å…ˆåœ¨ç»ˆç«¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export DATABASE_URL="postgres://user:pass@localhost:5432/db"`ã€‚

### å¸¸ç”¨å‘½ä»¤å¯¹æ¯”è¡¨

| **å‘½ä»¤**        | **è¡Œä¸º**                            | **å±é™©ç­‰çº§** | **é€‚ç”¨åœºæ™¯**                   |
| --------------------- | ----------------------------------------- | ------------------ | ------------------------------------ |
| **`up`**      | è¿è¡Œæ‰€æœ‰æœªæ‰§è¡Œçš„è¿ç§»ã€‚                    | ğŸŸ¢ å®‰å…¨            | æ—¥å¸¸æ›´æ–°æ•°æ®åº“ã€‚                     |
| **`down`**    | æ’¤é”€æœ€åä¸€æ¬¡è¿ç§»ã€‚                        | ğŸŸ¡ ä¸­ç­‰            | å‘ç°åˆšå†™çš„è„šæœ¬æœ‰é”™ï¼Œå›æ»šä¸€ä¸‹ã€‚       |
| **`status`**  | åˆ—å‡ºå“ªäº›å·²è·‘ï¼Œå“ªäº›è¿˜æ²¡è·‘ã€‚                | ğŸŸ¢ å®‰å…¨            | æ£€æŸ¥å½“å‰æ•°æ®åº“ç‰ˆæœ¬ã€‚                 |
| **`refresh`** | å…ˆå›æ»šæ‰€æœ‰è¿ç§»ï¼Œå†é‡æ–°å…¨éƒ¨è·‘ä¸€éã€‚        | ğŸ”´ å±é™©            | ç›¸å½“äºé‡ç½®æ•°æ®ï¼Œä½†ä¿ç•™è¡¨ç»“æ„çš„å˜åŒ–ã€‚ |
| **`fresh`**   | **ç›´æ¥åˆ æ‰æ‰€æœ‰è¡¨** ï¼Œå†é‡æ–°è·‘ä¸€éã€‚ | ğŸ’€ æé«˜            | æ•°æ®åº“æä¹±äº†ï¼Œæƒ³å½»åº•æ¨å€’é‡æ¥ã€‚       |
| **`reset`**   | å›æ»šæ‰€æœ‰å·²åº”ç”¨çš„è¿ç§»ã€‚                    | ğŸ”´ å±é™©            | æ¸…ç©ºæ•°æ®åº“ç»“æ„ã€‚         |

### A. å‘½ä»¤è¡Œç•Œé¢ (CLI) å¸¸ç”¨æ“ä½œ

* `sea-orm-cli migrate init`: åˆå§‹åŒ–è¿ç§»ç›®å½•ï¼Œç”ŸæˆåŸºç¡€ç»“æ„, eg: `sea-orm-cli migrate init`ã€‚
* `sea-orm-cli migrate generate [NAME]`: ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æ–°è¿ç§»æ–‡ä»¶, eg: `sea-orm-cli migrate generate create_user_table`ã€‚
* `sea-orm-cli migrate up`: åº”ç”¨æ‰€æœ‰æŒ‚èµ·çš„ï¼ˆæœªæ‰§è¡Œçš„ï¼‰è¿ç§»ä»»åŠ¡, eg: `sea-orm-cli migrate up`ã€‚
* `sea-orm-cli migrate up -n [NUM]`: åº”ç”¨æŒ‡å®šæ•°é‡çš„æŒ‚èµ·è¿ç§»ä»»åŠ¡, eg: `sea-orm-cli migrate up -n 3`ã€‚
* `sea-orm-cli migrate down`: æ’¤é”€æœ€åä¸€æ¬¡åº”ç”¨çš„è¿ç§»ä»»åŠ¡, eg: `sea-orm-cli migrate down`ã€‚
* `sea-orm-cli migrate down -n [NUM]`: æ’¤é”€æœ€è¿‘æŒ‡å®šæ•°é‡çš„è¿ç§»ä»»åŠ¡, eg: `sea-orm-cli migrate down -n 2`ã€‚
* `sea-orm-cli migrate status`: æŸ¥çœ‹æ‰€æœ‰è¿ç§»ä»»åŠ¡çš„çŠ¶æ€ï¼ˆå·²åº”ç”¨æˆ–æŒ‚èµ·ï¼‰, eg: `sea-orm-cli migrate status`ã€‚
* `sea-orm-cli migrate fresh`: åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼Œå¹¶é‡æ–°ä»å¤´åº”ç”¨æ‰€æœ‰è¿ç§», eg: `sea-orm-cli migrate fresh`ã€‚
* `sea-orm-cli migrate refresh`: å›æ»šæ‰€æœ‰å·²åº”ç”¨çš„è¿ç§»ï¼Œç„¶åé‡æ–°åº”ç”¨å®ƒä»¬, eg: `sea-orm-cli migrate refresh`ã€‚
* `sea-orm-cli migrate reset`: å›æ»šæ‰€æœ‰å·²åº”ç”¨çš„è¿ç§»ä»»åŠ¡, eg: `sea-orm-cli migrate reset`ã€‚

---

### B. ç¨‹åºåŒ–è°ƒç”¨ (åœ¨ Rust ä»£ç ä¸­è¿è¡Œ)

* `Migrator::up(db, None)`: åœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åº”ç”¨æ‰€æœ‰æŒ‚èµ·çš„è¿ç§», eg: `Migrator::up(&db, None).await?`ã€‚
* `Migrator::up(db, Some(n))`: åœ¨ä»£ç ä¸­åº”ç”¨å‰ `n` ä¸ªæŒ‚èµ·çš„è¿ç§», eg: `Migrator::up(&db, Some(5)).await?`ã€‚
* `Migrator::down(db, None)`: åœ¨ä»£ç ä¸­å›æ»šæ‰€æœ‰å·²åº”ç”¨çš„è¿ç§»ï¼ˆç­‰åŒäº resetï¼‰, eg: `Migrator::down(&db, None).await?`ã€‚
* `Migrator::down(db, Some(n))`: åœ¨ä»£ç ä¸­å›æ»šæœ€å `n` ä¸ªè¿ç§», eg: `Migrator::down(&db, Some(1)).await?`ã€‚
* `Migrator::status(db)`: åœ¨ä»£ç ä¸­æ£€æŸ¥è¿ç§»çŠ¶æ€, eg: `let status = Migrator::status(&db).await?`ã€‚
* `Migrator::fresh(db)`: åœ¨ä»£ç ä¸­æ‰§è¡Œâ€œåˆ è¡¨é‡ç»ƒâ€æ“ä½œ, eg: `Migrator::fresh(&db).await?`ã€‚
* `Migrator::refresh(db)`: åœ¨ä»£ç ä¸­æ‰§è¡Œâ€œé‡ç½®å¹¶é‡å¯â€è¿ç§», eg: `Migrator::refresh(&db).await?`ã€‚
* `Migrator::reset(db)`: åœ¨ä»£ç ä¸­æ’¤é”€æ‰€æœ‰è¿ç§», eg: `Migrator::reset(&db).await?`ã€‚
* `Migrator::get_pending_migrations(db)`: è·å–æ‰€æœ‰å°šæœªåº”ç”¨çš„è¿ç§»åˆ—è¡¨, eg: `let pending = Migrator::get_pending_migrations(&db).await?`ã€‚
* `Migrator::get_applied_migrations(db)`: è·å–æ‰€æœ‰å·²ç»æˆåŠŸåº”ç”¨çš„è¿ç§»åˆ—è¡¨, eg: `let applied = Migrator::get_applied_migrations(&db).await?`ã€‚

---

## 2. ä»£ç è‡ªåŠ¨æ‰§è¡Œï¼šç”Ÿäº§ç¯å¢ƒå¿…å¤‡

åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œä½ ä¸å¯èƒ½æ‰‹åŠ¨å»æ•²å‘½ä»¤è¡Œã€‚é€šå¸¸åœ¨ `main.rs` ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶å‡çº§æ•°æ®åº“ã€‚

```rust,ignore
use migration::{Migrator, MigratorTrait};
// åœ¨è¿æ¥æ•°æ®åº“åè°ƒç”¨
let db = Database::connect(url).await?;
// è‡ªåŠ¨æŠŠæ‰€æœ‰æ²¡è·‘çš„è¿ç§»è¡¥ä¸Š
Migrator::up(&db, None).await?; 
```

---
