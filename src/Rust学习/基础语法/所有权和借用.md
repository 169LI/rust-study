# æ‰€æœ‰æƒå’Œå€Ÿç”¨

æ‰€æœ‰æƒï¼ˆOwnershipï¼‰æ˜¯ Rust æœ€ä¸ºç‹¬ç‰¹ä¸”æ ¸å¿ƒçš„ç‰¹æ€§ã€‚å®ƒè®© Rust èƒ½å¤Ÿè„±ç¦»åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶ï¼Œåœ¨ç¼–è¯‘æœŸå³ç¡®ä¿å†…å­˜å®‰å…¨ã€‚

---

## ä¸€ã€ å†…å­˜ç®¡ç†çš„ä¸‰å¤§æµæ´¾

åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œç®¡ç†å†…å­˜é€šå¸¸æœ‰ä¸‰ç§æ–¹å¼ï¼š

1. **åƒåœ¾å›æ”¶ (GC)** ï¼šå¦‚ Javaã€Goã€Pythonã€‚ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚ä¼˜ç‚¹æ˜¯å¼€å‘å¿«ï¼Œç¼ºç‚¹æ˜¯è¿è¡Œæ—¶å¼€é”€å¤§ï¼Œå¯èƒ½å‡ºç°â€œåœé¡¿â€ã€‚
2. **æ‰‹åŠ¨ç®¡ç†** ï¼šå¦‚ C/C++ã€‚ç¨‹åºå‘˜æ‰‹åŠ¨è°ƒç”¨ `malloc/free`ã€‚ä¼˜ç‚¹æ˜¯æè‡´æ€§èƒ½ï¼Œç¼ºç‚¹æ˜¯æå…¶å®¹æ˜“å‡ºç° **æ‚¬ç©ºæŒ‡é’ˆ** ã€**åŒé‡é‡Šæ”¾**æˆ– **å†…å­˜æ³„æ¼** ã€‚
3. **æ‰€æœ‰æƒç³»ç»Ÿ** ï¼šRust çš„è·¯å¾„ã€‚é€šè¿‡ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ ¹æ®ä¸€å¥—è§„åˆ™æ£€æŸ¥å†…å­˜ç®¡ç†ã€‚ **é›¶è¿è¡Œæ—¶å¼€é”€** ã€‚

### é¢„å¤‡çŸ¥è¯†ï¼šæ ˆ (Stack) ä¸ å † (Heap)

#### æ ˆ

æ ˆæŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œ **åè¿›å…ˆå‡º** ã€‚æƒ³è±¡ä¸€ä¸‹ä¸€å ç›˜å­ï¼šå½“å¢åŠ æ›´å¤šç›˜å­æ—¶ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨ç›˜å­å †çš„é¡¶éƒ¨ï¼Œå½“éœ€è¦ç›˜å­æ—¶ï¼Œå†ä»é¡¶éƒ¨æ‹¿èµ°ã€‚ä¸èƒ½ä»ä¸­é—´ä¹Ÿä¸èƒ½ä»åº•éƒ¨å¢åŠ æˆ–æ‹¿èµ°ç›˜å­ï¼

å¢åŠ æ•°æ®å«åš **è¿›æ ˆ** ï¼Œç§»å‡ºæ•°æ®åˆ™å«åš **å‡ºæ ˆ** ã€‚

å› ä¸ºä¸Šè¿°çš„å®ç°æ–¹å¼ï¼Œæ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå‡è®¾æ•°æ®å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆåœ¨å–å‡ºæ•°æ®æ—¶ï¼Œä½ å°†æ— æ³•å–åˆ°ä½ æƒ³è¦çš„æ•°æ®ã€‚

#### å †

ä¸æ ˆä¸åŒï¼Œå¯¹äºå¤§å°æœªçŸ¥æˆ–è€…å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå­˜å‚¨åœ¨å †ä¸Šã€‚

å½“å‘å †ä¸Šæ”¾å…¥æ•°æ®æ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„ **æŒ‡é’ˆ** ï¼Œè¯¥è¿‡ç¨‹è¢«ç§°ä¸º **åœ¨å †ä¸Šåˆ†é…å†…å­˜** ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€(allocating)ã€‚

æ¥ç€ï¼Œè¯¥æŒ‡é’ˆä¼šè¢«æ¨å…¥**æ ˆ**ä¸­ï¼Œå› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œåœ¨åç»­ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å°†é€šè¿‡æ ˆä¸­çš„ **æŒ‡é’ˆ** ï¼Œæ¥è·å–æ•°æ®åœ¨å †ä¸Šçš„å®é™…å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®è¯¥æ•°æ®ã€‚

ç”±ä¸Šå¯çŸ¥ï¼Œå †æ˜¯ä¸€ç§ç¼ºä¹ç»„ç»‡çš„æ•°æ®ç»“æ„ã€‚æƒ³è±¡ä¸€ä¸‹å»é¤é¦†å°±åº§åƒé¥­ï¼šè¿›å…¥é¤é¦†ï¼Œå‘ŠçŸ¥æœåŠ¡å‘˜æœ‰å‡ ä¸ªäººï¼Œç„¶åæœåŠ¡å‘˜æ‰¾åˆ°ä¸€ä¸ªå¤Ÿå¤§çš„ç©ºæ¡Œå­ï¼ˆå †ä¸Šåˆ†é…çš„å†…å­˜ç©ºé—´ï¼‰å¹¶é¢†ä½ ä»¬è¿‡å»ã€‚å¦‚æœæœ‰äººæ¥è¿Ÿäº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¡Œå·ï¼ˆæ ˆä¸Šçš„æŒ‡é’ˆï¼‰æ¥æ‰¾åˆ°ä½ ä»¬ååœ¨å“ªã€‚

#### æ€§èƒ½åŒºåˆ«

åœ¨æ ˆä¸Šåˆ†é…å†…å­˜æ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºå…¥æ ˆæ—¶æ“ä½œç³»ç»Ÿæ— éœ€è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼ˆæˆ–æ›´æ…¢çš„ç³»ç»Ÿè°ƒç”¨ï¼‰æ¥åˆ†é…æ–°çš„ç©ºé—´ï¼Œåªéœ€è¦å°†æ–°æ•°æ®æ”¾å…¥æ ˆé¡¶å³å¯ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ï¼Œå¦‚æœå½“å‰è¿›ç¨‹åˆ†é…çš„å†…å­˜é¡µä¸è¶³æ—¶ï¼Œè¿˜éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ¥ç”³è¯·æ›´å¤šå†…å­˜ã€‚ å› æ­¤ï¼Œå¤„ç†å™¨åœ¨æ ˆä¸Šåˆ†é…æ•°æ®ä¼šæ¯”åœ¨å †ä¸Šåˆ†é…æ•°æ®æ›´åŠ é«˜æ•ˆã€‚

#### æ‰€æœ‰æƒä¸å †æ ˆ

å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆå’Œå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ä¾æ¬¡è¢«å‹å…¥æ ˆä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œè¿™äº›å€¼å°†è¢«ä»æ ˆä¸­æŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡ç§»é™¤ã€‚

å› ä¸ºå †ä¸Šçš„æ•°æ®ç¼ºä¹ç»„ç»‡ï¼Œå› æ­¤è·Ÿè¸ªè¿™äº›æ•°æ®ä½•æ—¶åˆ†é…å’Œé‡Šæ”¾æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™å †ä¸Šçš„æ•°æ®å°†äº§ç”Ÿå†…å­˜æ³„æ¼ â€”â€” è¿™äº›æ•°æ®å°†æ°¸è¿œæ— æ³•è¢«å›æ”¶ã€‚è¿™å°±æ˜¯ Rust æ‰€æœ‰æƒç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å¼ºå¤§ä¿éšœã€‚

å¯¹äºå…¶ä»–å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œä½ ç¡®å®æ— éœ€ç†è§£å †æ ˆçš„åŸç†ï¼Œä½†æ˜¯ **åœ¨ Rust ä¸­ï¼Œæ˜ç™½å †æ ˆçš„åŸç†ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£æ‰€æœ‰æƒçš„å·¥ä½œåŸç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©** ã€‚

---

## äºŒã€ æ‰€æœ‰æƒ

* **ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒï¼Ÿ** ï¼šæ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªâ€œæ‰€æœ‰è€…â€ï¼ˆownerï¼‰ï¼Œè´Ÿè´£åœ¨å€¼è¶…å‡ºä½œç”¨åŸŸæ—¶é‡Šæ”¾å®ƒã€‚Rust ä½¿ç”¨æ‰€æœ‰æƒæ¥ç®¡ç†å †å†…å­˜ï¼Œè€Œä¸ä¾èµ–åƒåœ¾å›æ”¶å™¨ã€‚
* **ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ** ï¼šé˜²æ­¢åŒé‡é‡Šæ”¾ï¼ˆdouble freeï¼‰ã€ä½¿ç”¨åé‡Šæ”¾ï¼ˆuse after freeï¼‰å’Œæ•°æ®ç«äº‰ã€‚
* **ä¸‰æ¡é“å¾‹æ„å»º** ï¼š

### æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œç§°ä¸ºå®ƒçš„â€œæ‰€æœ‰è€…â€

åœ¨ Rust ä¸­ï¼Œå†…å­˜ä¸­çš„æ•°æ®ï¼ˆå€¼ï¼‰ä¸èƒ½å­¤ç«‹å­˜åœ¨ï¼Œå¿…é¡»ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸Šã€‚

```rust,edition
fn main() {
    // è¿™ä¸ª String å­—ç¬¦ä¸²å€¼åœ¨å †ä¸Šåˆ›å»º
    // å˜é‡ s æˆäº†è¿™ä¸ªå­—ç¬¦ä¸²çš„â€œæ‰€æœ‰è€…â€
    let s = String::from("hello"); 

    println!("s æ‹¥æœ‰è¿™ä¸ªå€¼: {}", s);
} // å‡½æ•°ç»“æŸï¼Œs è¶…å‡ºä½œç”¨åŸŸï¼Œå€¼è¢«ä¸¢å¼ƒ
```

### åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªå€¼åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…

è¿™æ˜¯ Rust å®‰å…¨æ€§çš„æ ¸å¿ƒã€‚å¦‚æœä¸€ä¸ªå †ä¸Šçš„å€¼æœ‰ä¸¤ä¸ªæ‰€æœ‰è€…ï¼Œå°±ä¼šå‘ç”Ÿâ€œäºŒæ¬¡é‡Šæ”¾â€å†…å­˜é”™è¯¯ã€‚å› æ­¤ï¼ŒRust å¼ºåˆ¶æ‰§è¡Œæ‰€æœ‰æƒç§»åŠ¨ï¼ˆMoveï¼‰ã€‚

```rust,edition
fn main() {
    let s1 = String::from("hello");
    
    // æ‰€æœ‰æƒä» s1 è½¬ç§»åˆ°äº† s2
    // æ­¤æ—¶å†…å­˜ä¸­ä»ç„¶åªæœ‰ä¸€ä¸ª "hello"ï¼Œä½†æ‰€æœ‰è€…å˜æˆäº† s2
    let s2 = s1; 

    // println!("{}", s1); 
    // âŒ ç¼–è¯‘æŠ¥é”™ï¼s1 ä¸å†æ‹¥æœ‰è¯¥å€¼ï¼Œå®ƒå·²ç»â€œå¤±æ•ˆâ€äº†ã€‚
    
    println!("ç°åœ¨æ‰€æœ‰æƒåœ¨ s2 æ‰‹é‡Œ: {}", s2); 
}
```

### å½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼å°†è¢«ä¸¢å¼ƒï¼ˆ`drop`ï¼‰

Rust è‡ªåŠ¨ç®¡ç†å†…å­˜çš„ç§˜è¯€å°±åœ¨è¿™é‡Œï¼šé€šè¿‡å¤§æ‹¬å· {} å®šä¹‰ä½œç”¨åŸŸï¼Œä¸€æ—¦èµ°å‡ºå¤§æ‹¬å·ï¼Œå˜é‡å°±ä¼šè¢«é”€æ¯ï¼Œå†…å­˜ç«‹å³å›æ”¶ã€‚

```rust,edition
fn main() {
    {
        // s ä»è¿™é‡Œå¼€å§‹æœ‰æ•ˆ
        let s = String::from("hello"); 
        println!("ä½œç”¨åŸŸå†…: {}", s);
    } 
    // ğŸ’¡ æ‰§è¡Œåˆ°è¿™é‡Œï¼Œä½œç”¨åŸŸç»“æŸã€‚
    // Rust è‡ªåŠ¨è°ƒç”¨ `drop` å‡½æ•°ï¼Œé‡Šæ”¾ s å ç”¨çš„å †å†…å­˜ã€‚

    // println!("{}", s); 
    // âŒ ç¼–è¯‘æŠ¥é”™ï¼s å·²ç»ä¸åœ¨è¿™é‡Œäº†ï¼Œå†…å­˜å·²ç»è¿˜ç»™ç³»ç»Ÿäº†ã€‚
}
```

---

## ä¸‰ã€ å˜é‡äº¤äº’ï¼šç§»åŠ¨ã€å…‹éš†ä¸å¤åˆ¶

### 1. ç§»åŠ¨ (Move)

å¯¹äºå­˜å‚¨åœ¨å †ä¸Šçš„å¤æ‚ç±»å‹ï¼ˆå¦‚ `String`ï¼‰ï¼Œèµ‹å€¼æ“ä½œé»˜è®¤æ˜¯â€œç§»åŠ¨â€ã€‚ä¸ºäº†é˜²æ­¢ **åŒé‡é‡Šæ”¾** ï¼ŒRust ä¼šä½¿åŸå˜é‡å¤±æ•ˆã€‚

```rust,edition
fn main() {
    let s1 = String::from("hello");
    let s2 = s1; // æ‰€æœ‰æƒç§»åŠ¨åˆ°äº† s2ï¼Œs1 æ­¤æ—¶å·²å¤±æ•ˆ

    // println!("{s1}"); // âŒ ç¼–è¯‘é”™è¯¯ï¼šä½¿ç”¨äº†å·²ç§»åŠ¨çš„å€¼
    println!("{s2}");    // âœ… æœ‰æ•ˆ
}
```

### 2. å…‹éš† (Clone) â€”â€” æ·±æ‹·è´

å¦‚æœä½ ç¡®å®éœ€è¦å¤åˆ¶å †ä¸Šçš„æ•°æ®ï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨ `clone`ã€‚

```rust,edition
fn main() {
    let s1 = String::from("hello");
    let s2 = s1.clone(); // åœ¨å †ä¸Šäº§ç”Ÿäº†ä¸€ä»½å®Œæ•´å‰¯æœ¬

    println!("s1 = {s1}, s2 = {s2}"); // âœ… ä¸¤è€…å‡æœ‰æ•ˆ
}
```

### 3. å¤åˆ¶ (Copy) â€”â€” æ ˆæ•°æ®æ‹·è´

å¯¹äºç®€å•ã€å›ºå®šå¤§å°ä¸”å®Œå…¨å­˜å‚¨åœ¨æ ˆä¸Šçš„ç±»å‹ï¼ŒRust ä¼šæ‰§è¡Œè‡ªåŠ¨æ‹·è´ï¼Œè€Œä¸ä¼šä½¿åŸå˜é‡å¤±æ•ˆã€‚å¸¸è§çš„ `Copy` ç±»å‹åŒ…æ‹¬ï¼šæ‰€æœ‰çš„æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ã€å­—ç¬¦ï¼Œä»¥åŠåªåŒ…å«è¿™äº›ç±»å‹çš„å…ƒç»„ã€‚

```rust,edition
fn main() {
    let x = 5;
    let y = x; // æ ˆæ•°æ®ç›´æ¥æ‹·è´ï¼Œä¸æ¶‰åŠæ‰€æœ‰æƒè½¬ç§»
    println!("x = {x}, y = {y}"); // âœ… ä¸¤è€…å‡æœ‰æ•ˆ
}
```

---

## å››ã€ å¼•ç”¨ä¸å€Ÿç”¨ (References & Borrowing)

å¦‚æœä½ ä¸æƒ³è½¬ç§»æ‰€æœ‰æƒï¼Œä½†åˆæƒ³ä½¿ç”¨æ•°æ®ï¼Œå°±éœ€è¦â€œå€Ÿç”¨â€ã€‚å¼•ç”¨ï¼ˆ`&`ï¼‰å°±åƒæ˜¯ç°å®ä¸­çš„å€Ÿä¹¦ï¼šä½ å¯ä»¥çœ‹ä¹¦ï¼Œä½†ä¹¦ä¸å±äºä½ ï¼Œçœ‹å®Œå¾—è¿˜ã€‚

### 1. ä¸å¯å˜å€Ÿç”¨ (`&T`)

ä½ å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªä¸å¯å˜å¼•ç”¨ï¼Œå› ä¸ºâ€œåªè¯»â€ä¸ä¼šå¼•èµ·æ•°æ®ç«äº‰ã€‚

```rust,edition
fn calculate_length(s: &String) -> usize {
    s.len()
} // s ç¦»å¼€ä½œç”¨åŸŸï¼Œä½†å› ä¸ºå®ƒåªæ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿ drop

fn main() {
    let s1 = String::from("hello");
    let len = calculate_length(&s1); // ä¼ å…¥å¼•ç”¨
    println!("'{s1}' çš„é•¿åº¦æ˜¯ {len}"); // âœ… s1 ä¾ç„¶æœ‰æ•ˆ
}
```

### 2. å¯å˜å€Ÿç”¨ (`&mut T`)

å¦‚æœä½ éœ€è¦ä¿®æ”¹å€Ÿç”¨çš„æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨å¯å˜å¼•ç”¨ã€‚ä½†å®ƒæœ‰æå¼ºçš„é™åˆ¶ï¼š**åœ¨åŒä¸€ä½œç”¨åŸŸå†…ï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚**

```rust,edition
fn change(some_string: &mut String) {
    some_string.push_str(", world");
}

fn main() {
    let mut s = String::from("hello");
    change(&mut s);
    println!("{s}");
}
```

### 3. å€Ÿç”¨è§„åˆ™æ€»ç»“

ä¸ºäº†å½»åº•æ¶ˆé™¤ **æ•°æ®ç«äº‰** ï¼ŒRust å¼ºåˆ¶æ‰§è¡Œä»¥ä¸‹è§„åˆ™ï¼š

* **åœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œä½ è¦ä¹ˆåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„ä¸å¯å˜å¼•ç”¨ã€‚**
* **å¼•ç”¨å¿…é¡»å§‹ç»ˆæœ‰æ•ˆï¼ˆé˜²æ­¢æ‚¬å‚å¼•ç”¨ï¼‰ã€‚**

---

## äº”ã€ NLLï¼šæ›´æ™ºèƒ½çš„å€Ÿç”¨æ£€æŸ¥

åœ¨æ—§ç‰ˆ Rust ä¸­ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸæŒç»­åˆ°å¤§æ‹¬å·ç»“æŸã€‚ç°ä»£ Rust ä½¿ç”¨äº†  **NLL (Non-Lexical Lifetimes)** ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸåœ¨**æœ€åä¸€æ¬¡ä½¿ç”¨**å¤„ç»“æŸã€‚è¿™è§£å†³äº†è®¸å¤šâ€œæœ¬è¯¥é€šè¿‡ä½†æ²¡é€šè¿‡â€çš„ç¼–è¯‘é—®é¢˜ã€‚

```rust,edition
fn main() {
    let mut s = String::from("hello");

    let r1 = &s; 
    let r2 = &s;
    println!("{r1} and {r2}"); 
    // r1 å’Œ r2 åœ¨æ­¤å¤„ä¹‹åä¸å†ä½¿ç”¨ï¼Œå…¶ä½œç”¨åŸŸç»“æŸ

    let r3 = &mut s; // âœ… å…è®¸ï¼Œå› ä¸ºä¹‹å‰çš„ä¸å¯å˜å€Ÿç”¨å·²å¤±æ•ˆ
    println!("{r3}");
}
```

---

## å…­ã€ æ‚¬å‚å¼•ç”¨ (Dangling References)

Rust ä¼šåœ¨ç¼–è¯‘æœŸé˜»æ­¢ä½ è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨ï¼Œå› ä¸ºå±€éƒ¨å˜é‡åœ¨å‡½æ•°ç»“æŸæ—¶ä¼šè¢«é‡Šæ”¾ã€‚

```rust,edition
// âŒ æ— æ³•é€šè¿‡ç¼–è¯‘
// fn dangle() -> &String {
//     let s = String::from("hello");
//     &s // è¿”å›äº†å¯¹å±€éƒ¨å˜é‡ s çš„å¼•ç”¨
// } 

// âœ… æ­£ç¡®åšæ³•ï¼šç›´æ¥è¿”å› String (ç§»åŠ¨æ‰€æœ‰æƒ)
fn no_dangle() -> String {
    let s = String::from("hello");
    s 
}

fn main() {
    let s = no_dangle();
}
```

---

## ä¸ƒã€ è‡ªåŠ¨é‡Šæ”¾ï¼šDrop ä¸ RAII

Rust é€šè¿‡ `Drop` trait å®ç°  **RAII (èµ„æºè·å–å³åˆå§‹åŒ–)** ã€‚å½“å˜é‡è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼ŒRust è‡ªåŠ¨è°ƒç”¨ `drop` æ–¹æ³•é‡Šæ”¾å †å†…å­˜ã€‚

```rust,edition
struct CustomSmartPointer {
    data: String,
}

impl Drop for CustomSmartPointer {
    fn drop(&mut self) {
        println!("æ­£åœ¨æ¸…ç†æ•°æ®: `{}`", self.data);
    }
}

fn main() {
    let c = CustomSmartPointer { data: String::from("my stuff") };
    let d = CustomSmartPointer { data: String::from("other stuff") };
    println!("CustomSmartPointers å·²åˆ›å»ºã€‚");
} // æ­¤å¤„ d å…ˆè¢« dropï¼Œç„¶å c è¢« drop
```

---

### å¦‚ä½•å†™å‡ºç¬¦åˆæ‰€æœ‰æƒçš„ä»£ç ï¼Ÿ

1. **ä¼˜å…ˆå€Ÿç”¨** ï¼šé™¤éä½ ç¡®å®éœ€è¦è·å–æ•°æ®çš„æ‰€æœ‰æƒï¼ˆä¾‹å¦‚è¦æŠŠæ•°æ®å­˜å…¥ç»“æ„ä½“ä¸­ï¼‰ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨å¼•ç”¨ `&T`ã€‚
2. **å‡å°‘ Clone** ï¼šå¦‚æœå‘ç°ä»£ç é‡Œåˆ°å¤„æ˜¯ `.clone()`ï¼Œé€šå¸¸è¯´æ˜æ‰€æœ‰æƒè®¾è®¡æœ‰è¯¯ã€‚
3. **åˆ©ç”¨ä½œç”¨åŸŸ** ï¼šå¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ  `{ }` æ¥ç¼©çŸ­å˜é‡æˆ–å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»è€Œè§£å†³å€Ÿç”¨å†²çªã€‚
